!function(){"use strict";function o(t,e,n,o){this.target=t,this.url=e,this.html=[],this.effectQueue=[],this.version="3.4.1",this.options=$.extend({ssl:!1,host:"www.feedrapp.info",support:!0,limit:null,key:null,layoutTemplate:"<ul>{entries}</ul>",entryTemplate:'<li><a href="{url}">[{author}@{date}] {title}</a><br/>{shortBodyPlain}</li>',tokens:{},outputMode:"json",dateFormat:"dddd MMM Do",dateLocale:"en",effect:"show",offsetStart:!1,offsetEnd:!1,error:function(){console.log("jQuery RSS: url doesn't link to RSS-Feed")},onData:function(){},success:function(){}},n||{}),this.callback=o||this.options.success}o.htmlTags=["doctype","html","head","title","base","link","meta","style","script","noscript","body","article","nav","aside","section","header","footer","h1-h6","hgroup","address","p","hr","pre","blockquote","ol","ul","li","dl","dt","dd","figure","figcaption","div","table","caption","thead","tbody","tfoot","tr","th","td","col","colgroup","form","fieldset","legend","label","input","button","select","datalist","optgroup","option","textarea","keygen","output","progress","meter","details","summary","command","menu","del","ins","img","iframe","embed","object","param","video","audio","source","canvas","track","map","area","a","em","strong","i","b","u","s","small","abbr","q","cite","dfn","sub","sup","time","code","kbd","samp","var","mark","bdi","bdo","ruby","rt","rp","span","br","wbr"],o.prototype.load=function(t){var e="http"+(this.options.ssl?"s":"")+"://"+this.options.host+"?support="+this.options.support+"&version="+this.version+"&callback=?&q="+encodeURIComponent(this.url);this.options.offsetStart&&this.options.offsetEnd&&(this.options.limit=this.options.offsetEnd),null!==this.options.limit&&(e+="&num="+this.options.limit),null!==this.options.key&&(e+="&key="+this.options.key),$.getJSON(e,t)},o.prototype.render=function(){var o=this;this.load(function(t){try{o.feed=t.responseData.feed,o.entries=t.responseData.feed.entries}catch(t){return o.entries=[],o.feed=null,o.options.error.call(o)}var e=o.generateHTMLForEntries();if(o.target.append(e.layout),0!==e.entries.length){$.isFunction(o.options.onData)&&o.options.onData.call(o);var n=$(e.layout).is("entries")?e.layout:$("entries",e.layout);o.appendEntriesAndApplyEffects(n,e.entries)}0<o.effectQueue.length?o.executeEffectQueue(o.callback):$.isFunction(o.callback)&&o.callback.call(o)})},o.prototype.appendEntriesAndApplyEffects=function(o,t){var i=this;$.each(t,function(t,e){var n=i.wrapContent(e);"show"===i.options.effect?o.before(n):(n.css({display:"none"}),o.before(n),i.applyEffect(n,i.options.effect))}),o.remove()},o.prototype.generateHTMLForEntries=function(){var i=this,s={entries:[],layout:null};return $(this.entries).each(function(){var t,e=this,n=i.options.offsetStart,o=i.options.offsetEnd;n&&o?index>=n&&index<=o&&i.isRelevant(e,s.entries)&&(t=i.evaluateStringForEntry(i.options.entryTemplate,e),s.entries.push(t)):i.isRelevant(e,s.entries)&&(t=i.evaluateStringForEntry(i.options.entryTemplate,e),s.entries.push(t))}),this.options.entryTemplate?s.layout=this.wrapContent(this.options.layoutTemplate.replace("{entries}","<entries></entries>")):s.layout=this.wrapContent("<div><entries></entries></div>"),s},o.prototype.wrapContent=function(t){return 0!==$.trim(t).indexOf("<")?$("<div>"+t+"</div>"):$(t)},o.prototype.applyEffect=function(t,e,n){switch(e){case"slide":t.slideDown("slow",n);break;case"slideFast":t.slideDown(n);break;case"slideSynced":this.effectQueue.push({element:t,effect:"slide"});break;case"slideFastSynced":this.effectQueue.push({element:t,effect:"slideFast"})}},o.prototype.executeEffectQueue=function(e){var n=this;this.effectQueue.reverse();var o=function(){var t=n.effectQueue.pop();t?n.applyEffect(t.element,t.effect,o):e&&e()};o()},o.prototype.evaluateStringForEntry=function(t,e){var n=t,o=this;return $(t.match(/(\{.*?\})/g)).each(function(){var t=this.toString();n=n.replace(t,o.getValueForToken(t,e))}),n},o.prototype.isRelevant=function(t,e){var n=this.getTokenMap(t);return!this.options.filter||(!this.options.filterLimit||this.options.filterLimit!==e.length)&&this.options.filter(t,n)},o.prototype.getFormattedDate=function(t){if(this.options.dateFormatFunction)return this.options.dateFormatFunction(t);if("undefined"==typeof moment)return t;var e=moment(new Date(t));return(e=e.locale?e.locale(this.options.dateLocale):e.lang(this.options.dateLocale)).format(this.options.dateFormat)},o.prototype.getTokenMap=function(n){if(!this.feedTokens){var t=JSON.parse(JSON.stringify(this.feed));delete t.entries,this.feedTokens=t}return $.extend({feed:this.feedTokens,url:n.link,author:n.author,date:this.getFormattedDate(n.publishedDate),title:n.title,body:n.content,shortBody:n.contentSnippet,bodyPlain:function(){for(var t=n.content.replace(/<script[\\r\\\s\S]*<\/script>/gim,"").replace(/<\/?[^>]+>/gi,""),e=0;e<o.htmlTags.length;e++)t=t.replace(new RegExp("<"+o.htmlTags[e],"gi"),"");return t}(),shortBodyPlain:n.contentSnippet.replace(/<\/?[^>]+>/gi,""),index:$.inArray(n,this.entries),totalEntries:this.entries.length,teaserImage:function(t){try{return t.content.match(/(<img.*?>)/gi)[0]}catch(t){return""}}(n),teaserImageUrl:function(t){try{return t.content.match(/(<img.*?>)/gi)[0].match(/src="(.*?)"/)[1]}catch(t){return""}}(n)},this.options.tokens)},o.prototype.getValueForToken=function(t,e){var n=this.getTokenMap(e),o=n[t.replace(/[\{\}]/g,"")];if(void 0!==o)return"function"==typeof o?o(e,n):o;throw new Error("Unknown token: "+t+", url:"+this.url)},$.fn.rss=function(t,e,n){return new o(this,t,e,n).render(),this},module.export=o}();
